overlay: 1.0.0
info:
  title: Colorado State Overlay
  version: 1.0.0
  description: |
    Colorado-specific modifications to the base Safety Net API schemas.
    Includes state program names, Colorado PEAK integration fields,
    and county-based administration tracking.

actions:
  # ============================================================================
  # Person Schema Modifications (components/person.yaml)
  # Note: Person uses allOf composition, so properties are under allOf[1]
  # ============================================================================

  # Colorado gender options (separate from biological sex)
  - target: $.DemographicInfo.properties
    description: Colorado allows X gender marker on state IDs
    update:
      gender:
        type: string
        description: Gender identity per Colorado law allowing X gender marker.
        enum:
          - male
          - female
          - x
          - unknown

  # Add Colorado-specific county tracking
  - target: $.Person.allOf.1.properties
    description: Add Colorado county and PEAK integration fields
    update:
      countyCode:
        type: string
        description: Colorado county FIPS code (001-125, odd numbers only).
        pattern: "^[0-1][0-2][0-9]$"
        example: "001"
      countyName:
        type: string
        description: Colorado county name.
        enum:
          - Adams
          - Alamosa
          - Arapahoe
          - Archuleta
          - Baca
          - Bent
          - Boulder
          - Broomfield
          - Chaffee
          - Cheyenne
          - Clear Creek
          - Conejos
          - Costilla
          - Crowley
          - Custer
          - Delta
          - Denver
          - Dolores
          - Douglas
          - Eagle
          - El Paso
          - Elbert
          - Fremont
          - Garfield
          - Gilpin
          - Grand
          - Gunnison
          - Hinsdale
          - Huerfano
          - Jackson
          - Jefferson
          - Kiowa
          - Kit Carson
          - La Plata
          - Lake
          - Larimer
          - Las Animas
          - Lincoln
          - Logan
          - Mesa
          - Mineral
          - Moffat
          - Montezuma
          - Montrose
          - Morgan
          - Otero
          - Ouray
          - Park
          - Phillips
          - Pitkin
          - Prowers
          - Pueblo
          - Rio Blanco
          - Rio Grande
          - Routt
          - Saguache
          - San Juan
          - San Miguel
          - Sedgwick
          - Summit
          - Teller
          - Washington
          - Weld
          - Yuma
        example: "Denver"
      peakAccountId:
        type: string
        description: Colorado PEAK (Program Eligibility and Application Kit) account identifier.
        pattern: "^[A-Z0-9]{10}$"
        example: "PEAK123456"
      coloradoWorksEligible:
        type: boolean
        description: Indicates eligibility for Colorado Works (TANF).
      snapEligible:
        type: boolean
        description: Indicates eligibility for Colorado SNAP.
      healthFirstColoradoEligible:
        type: boolean
        description: Indicates eligibility for Health First Colorado (Medicaid).
      andcsEligible:
        type: boolean
        description: Indicates eligibility for Aid to the Needy Disabled - Colorado Supplement.

  # ============================================================================
  # Application Schema Modifications (components/application.yaml)
  # Programs are now per-person in HouseholdMember
  # ============================================================================

  # Colorado program names
  - target: $.Program.enum
    description: Colorado program names
    update:
      - snap
      - colorado_works
      - health_first_colorado
      - child_health_plan_plus
      - old_age_pension
      - andcs
      - leap
      - cccap

  # ============================================================================
  # User/Auth Schema Modifications (components/user.yaml, components/common.yaml)
  # ============================================================================

  # Colorado role terminology - only 3 roles supported
  - target: $.RoleType.enum
    file: components/common.yaml
    description: |
      Colorado supports only three roles:
      - technician (processes applications)
      - supervisor (oversees technicians)
      - district_ops_manager (oversees district operations)
    update:
      - technician
      - supervisor
      - district_ops_manager

  # Update RoleType description for Colorado terminology
  - target: $.RoleType.description
    file: components/common.yaml
    description: Colorado role descriptions
    update: |
      Colorado authorization roles:

      - technician: Process applications for assigned counties/programs
      - supervisor: Oversee technicians, approve determinations
      - district_ops_manager: Oversee district operations across counties

  # ============================================================================
  # FrontendAuthContext Modifications
  # Colorado customizations:
  #   - Standalone (does not extend BackendAuthContext)
  #   - email, firstName, lastName for user identification
  #   - roles array with name, county, and permissions object
  #   - Empty preferences object (reserved for future use)
  # ============================================================================

  - target: $.FrontendAuthContext
    file: components/user.yaml
    description: Colorado FrontendAuthContext - standalone, fully inlined
    update:
      type: object
      description: |
        Colorado authorization context for frontend applications.
        Standalone schema with email, name fields, and role-based permissions per county.
      properties:
        email:
          type: string
          format: email
          description: User's email address.
          example: "jane.smith@state.co.us"
        firstName:
          type: string
          description: User's first name.
          example: "Jane"
        lastName:
          type: string
          description: User's last name.
          example: "Smith"
        roles:
          type: array
          description: Role assignments with per-county permissions.
          items:
            type: object
            required:
              - name
              - county
            properties:
              name:
                type: string
                description: Role name.
                enum:
                  - technician
                  - supervisor
                  - district_ops_manager
                example: "technician"
              county:
                type: string
                description: Colorado county name.
                example: "Denver"
              permissions:
                type: object
                description: CRUD permissions by module.
                properties:
                  tasks:
                    type: array
                    items:
                      type: string
                      enum: [read, create, update, delete]
                  cases:
                    type: array
                    items:
                      type: string
                      enum: [read, create, update, delete]
                  documents:
                    type: array
                    items:
                      type: string
                      enum: [read, create, update, delete]
                  scheduling:
                    type: array
                    items:
                      type: string
                      enum: [read, create, update, delete]
                  reports:
                    type: array
                    items:
                      type: string
                      enum: [read, create, update, delete]
          example:
            - name: "technician"
              county: "Denver"
              permissions:
                tasks: ["read", "create"]
                cases: ["read", "update"]
                documents: ["read"]
                scheduling: ["read"]
                reports: ["read"]
        preferences:
          type: object
          description: User preferences (reserved for future use).

  # ============================================================================
  # User Modifications
  # Colorado customizations:
  #   - Remove email (now inherited from BackendAuthContext)
  #   - Add districts and programs
  # ============================================================================

  - target: $.User.allOf.1.properties.email
    file: components/user.yaml
    description: Remove email from User (inherited from BackendAuthContext)
    remove: true

  - target: $.User.allOf.1.required
    file: components/user.yaml
    description: Update required fields (remove email)
    update:
      - id
      - idpSubject
      - status
      - createdAt
      - updatedAt

  - target: $.User.allOf.1.properties
    file: components/user.yaml
    description: Colorado adds districts and programs to User
    update:
      districts:
        type: array
        items:
          type: string
        description: Colorado administrative districts the user can access.
        example: ["D01", "D05"]
      programs:
        type: array
        items:
          $ref: "./common.yaml#/Program"
        description: Programs the user is authorized to work on.
        example: ["snap", "colorado_works"]

  # ============================================================================
  # User Examples
  # Colorado examples use the standalone FrontendAuthContext structure
  # ============================================================================

  - target: $.UserExample1
    file: examples/users.yaml
    description: Colorado User example - technician role
    update:
      id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      idpSubject: "auth0|507f1f77bcf86cd799439011"
      email: "jane.smith@state.co.us"
      firstName: "Jane"
      lastName: "Smith"
      roles:
        - name: "technician"
          county: "Denver"
          permissions:
            tasks: ["read", "create"]
            cases: ["read", "update"]
            documents: ["read"]
            scheduling: ["read"]
            reports: ["read"]
      preferences: {}
      districts: ["D01"]
      programs: ["snap", "colorado_works"]
      status: "active"
      createdAt: "2024-01-15T10:30:00Z"
      updatedAt: "2024-01-15T10:30:00Z"

  - target: $.UserExample2
    file: examples/users.yaml
    description: Colorado User example - supervisor role
    update:
      id: "b2c3d4e5-f6a7-8901-bcde-f12345678901"
      idpSubject: "auth0|608f2f88cdf97de8a8540022"
      email: "john.doe@state.co.us"
      firstName: "John"
      lastName: "Doe"
      roles:
        - name: "supervisor"
          county: "Denver"
          permissions:
            tasks: ["read", "create", "update", "delete"]
            cases: ["read", "create", "update", "delete"]
            documents: ["read", "create", "update"]
            scheduling: ["read", "create", "update"]
            reports: ["read", "create"]
        - name: "technician"
          county: "Boulder"
          permissions:
            tasks: ["read", "create"]
            cases: ["read", "update"]
            documents: ["read"]
            scheduling: ["read"]
            reports: ["read"]
      preferences: {}
      districts: ["D01", "D05"]
      programs: ["snap", "colorado_works", "health_first_colorado"]
      status: "active"
      createdAt: "2024-02-01T08:00:00Z"
      updatedAt: "2024-03-10T14:22:00Z"

